---
title: "Class 7 R functions and packages"
author: "Xueyi Wan"
date: "2019/10/22"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R functions revisited

Source my functions from last day
```{r}
# a function that goes and runs another file
source("http://tinyurl.com/rescale-R")
```

```{r}
rescale(1:10)
```

```{r}
rescale(c(1, 10, 5, NA, 6), na.rm = TRUE)
```

## A new function called both_na()
Write a function to find where there are NA elements in two input vectors.

First make some simple input where I know the answer
```{r}
x <- c(1, 2, NA, 3, NA)
y <- c(NA, 3, NA, 3, 4)
```

looked online and found the **is.na()** function
```{r}
is.na(x)
is.na(y)
```

and the **which()** function tells me where the TRUE values are
```{r}
which(is.na(x))
which(is.na(y))
```

The AND function requires two input TRUE to give a TRUE output
```{r}
is.na(x) & is.na(y)
```

Taking the **sum()** of TRUEFALSE vector will tell me how mnany TRUE elements I have. 
```{r}
sum(is.na(x)&is.na(y))
```

```{r}
sum(c(TRUE, TRUE, FALSE, TRUE))
```


Now turn it into a function
```{r}
both_na <- function(x, y) {
  sum( is.na(x) & is.na(y))
}
```

Test function
```{r}
x <- c(NA, NA, NA)
y1 <- c(1, NA, NA)
y2 <- c(1, NA, NA, NA)
```

```{r}
both_na(x, y2)
```

```{r}
x2 <- c(NA, NA)
both_na(x2, y2)
```

This is re-cycle example of the colors
```{r}
plot(1:10, col = c("red", "blue", "green"))
```

```{r}
x <- c(NA, NA, NA)
y3 <- c(1, NA, NA, NA, NA, NA, NA)
both_na(x, y3)
# will make x the same length as y3
# view x as NA NA NA (NA NA NA NA)
# should get 6

x <- c(1, NA, NA)
y3 <- c(1, NA, NA, NA, NA, NA, NA)
both_na(x, y3)
# will make x the same length as y3
# view x as 1 NA NA (1 NA NA 1)
# same as this x <- c(1, NA, NA, 1, NA, NA, 1)
# should get 4
```

```{r}
length(x)
length(y3)
# tell me how long as ths x or y3
# match them? will get recycle problem

7 == 7
7 != 7
```


Add a check for when inputs x and y are not the same length
```{r}
both_na2 <- function(x, y) {
  if(length(x) != length(y)) {
    stop("Input x and y should be the same length")
    # the stop is where you input your error message
  }
  sum(is.na(x) & is.na(y))
}
```

```{r, eval = FALSE}
both_na2(x, y3)
```


write a function **grade()** to determine an overall grade from a vector of student homework assignment scores dropping the lowst single alignment score
```{r}
# student 1
student_1 <- c(100, 100, 100, 100, 100, 100, 100, 90)
# student 2
student_2 <- c(100, NA, 90, 90, 90, 90, 97, 80)
```

```{r}
# remove lowest score
student_1_factor <- student_1 != min(student_1)
student_1_score <- student_1[student_1_factor]
mean(student_1_score)

# alternative way to remove lowest score
which.min(student_2)
mean(student_2[-which.min(student_2)], na.rm = TRUE)
```

```{r}
any(is.na(student_2))
any(is.na(student_1))
```


We have our working code now turn it into a first function
```{r}
grade <- function(x) {
  if( any(is.na(x))) {
    warning("Student is missing a homework")
  }
  
  mean(x[-which.min(x)], na.rm = TRUE)
}
```

```{r}
grade(student_2)
```


now grade all students in an example class
```{r}
url <- "https://tinyurl.com/gradeinput"
hw <- read.csv(url, row.names = 1)
```

```{r}
apply(hw, 1, grade)
```

